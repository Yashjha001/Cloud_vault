<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="calculator-wrapper">
            <h1 class="title">
                <i class="fas fa-calculator"></i>
                Flask Calculator
            </h1>
            
            <!-- Display Result -->
            <div class="display-section">
                <div class="display" id="display">
                    {% if result is not none %}
                        {{ result }}
                    {% else %}
                        0
                    {% endif %}
                </div>
                {% if error %}
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        {{ error }}
                    </div>
                {% endif %}
            </div>

            <!-- Calculator Form -->
            <form method="POST" action="/" class="calculator-form" id="calculatorForm">
                <!-- Input Fields -->
                <div class="input-section">
                    <div class="input-group">
                        <label for="num1">First Number</label>
                        <input type="number" step="any" name="num1" id="num1" 
                               value="{{ num1 if num1 else '' }}" 
                               placeholder="Enter first number" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="num2">Second Number</label>
                        <input type="number" step="any" name="num2" id="num2" 
                               value="{{ num2 if num2 else '' }}" 
                               placeholder="Enter second number" required>
                    </div>
                </div>

                <!-- Operation Buttons -->
                <div class="operations-grid">
                    <button type="submit" name="operation" value="add" class="btn btn-operation">
                        <i class="fas fa-plus"></i>
                        Add
                    </button>
                    
                    <button type="submit" name="operation" value="subtract" class="btn btn-operation">
                        <i class="fas fa-minus"></i>
                        Subtract
                    </button>
                    
                    <button type="submit" name="operation" value="multiply" class="btn btn-operation">
                        <i class="fas fa-times"></i>
                        Multiply
                    </button>
                    
                    <button type="submit" name="operation" value="divide" class="btn btn-operation">
                        <i class="fas fa-divide"></i>
                        Divide
                    </button>
                </div>

                <!-- Advanced Operations -->
                <div class="advanced-operations">
                    <h3>Advanced Operations</h3>
                    <div class="operations-grid advanced-grid">
                        <button type="submit" name="operation" value="power" class="btn btn-advanced">
                            <i class="fas fa-superscript"></i>
                            Power (x^y)
                        </button>
                        
                        <button type="submit" name="operation" value="modulo" class="btn btn-advanced">
                            <i class="fas fa-percent"></i>
                            Modulo (%)
                        </button>
                        
                        <button type="submit" name="operation" value="sqrt" class="btn btn-advanced">
                            <i class="fas fa-square-root-alt"></i>
                            Square Root
                        </button>
                        
                        <button type="submit" name="operation" value="factorial" class="btn btn-advanced">
                            <i class="fas fa-exclamation"></i>
                            Factorial
                        </button>
                    </div>
                </div>

                <!-- Utility Buttons -->
                <div class="utility-section">
                    <button type="button" class="btn btn-utility" onclick="clearInputs()">
                        <i class="fas fa-trash"></i>
                        Clear
                    </button>
                    
                    <button type="button" class="btn btn-utility" onclick="copyResult()">
                        <i class="fas fa-copy"></i>
                        Copy Result
                    </button>
                </div>
            </form>

            <!-- History Section -->
            {% if history %}
            <div class="history-section">
                <h3>
                    <i class="fas fa-history"></i>
                    Calculation History
                </h3>
                <div class="history-list">
                    {% for calc in history %}
                    <div class="history-item">
                        <span class="calculation">{{ calc.expression }}</span>
                        <span class="result">= {{ calc.result }}</span>
                    </div>
                    {% endfor %}
                </div>
                <form method="POST" action="/clear_history" style="margin-top: 10px;">
                    <button type="submit" class="btn btn-clear-history">
                        <i class="fas fa-broom"></i>
                        Clear History
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button onclick="toggleTheme()" class="theme-btn" id="themeBtn">
            <i class="fas fa-moon"></i>
        </button>
    </div>

    <script>
        // Theme Toggle Functionality
        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.getElementById('themeBtn');
            const icon = themeBtn.querySelector('i');
            
            body.classList.toggle('dark-theme');
            
            if (body.classList.contains('dark-theme')) {
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            } else {
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeBtn').querySelector('i').className = 'fas fa-sun';
            }
        });

        // Clear inputs function
        function clearInputs() {
            document.getElementById('num1').value = '';
            document.getElementById('num2').value = '';
            document.getElementById('display').textContent = '0';
        }

        // Copy result function
        function copyResult() {
            const display = document.getElementById('display');
            const text = display.textContent;
            
            if (text !== '0') {
                navigator.clipboard.writeText(text).then(() => {
                    // Show feedback
                    const copyBtn = event.target.closest('.btn-utility');
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    copyBtn.style.backgroundColor = '#10b981';
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                        copyBtn.style.backgroundColor = '';
                    }, 2000);
                });
            }
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'Enter':
                        e.preventDefault();
                        document.querySelector('.btn-operation').click();
                        break;
                    case 'Backspace':
                        e.preventDefault();
                        clearInputs();
                        break;
                }
            }
        });

        // Add visual feedback for form submission
        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            const submitBtn = e.submitter;
            submitBtn.style.transform = 'scale(0.95)';
            submitBtn.style.opacity = '0.7';
            
            setTimeout(() => {
                submitBtn.style.transform = '';
                submitBtn.style.opacity = '';
            }, 150);
        });

        // Auto-focus first input
        window.addEventListener('load', () => {
            document.getElementById('num1').focus();
        });
    </script>
</body>
</html>